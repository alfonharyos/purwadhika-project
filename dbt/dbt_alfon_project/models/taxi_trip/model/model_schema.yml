version: 2

sources:
  - name: taxi_zone
    schema: jcdeol004_alfon_taxi_trip_raw
    tables:
      - name: raw_taxi_zone
        description: "Raw taxi zone lookup table from NYC TLC"

models:
  - name: fact_taxi_trip
    description: "Fact table containing all taxi trips (yellow & green) filtered and transformed for analysis"
    columns:
      - name: md5_key
        description: "Surrogate key (md5 hash of unique fields)"
        tests:
          - not_null
          - unique
      - name: taxi_type
        description: "Taxi type (yellow, green)"
        tests:
          - not_null
      - name: pickup_datetime
        description: "Pickup timestamp of the trip"
        tests:
          - not_null
      - name: dropoff_datetime
        description: "Dropoff timestamp of the trip"
      - name: pulocationid
        description: "Pickup location (linked to dim_location)"
        tests:
          - not_null
          - relationships:
              to: ref('dim_location')
              field: locationid
      - name: dolocationid
        description: "Dropoff location (linked to dim_location)"
        tests:
          - not_null
          - relationships:
              to: ref('dim_location')
              field: locationid
      - name: passenger_count
        description: "Number of passengers in the trip"
      - name: payment_type
        description: "Payment type (linked to dim_payment_type)"
        tests:
          - relationships:
              to: ref('dim_payment_type')
              field: payment_type
      - name: fare_amount
        description: "Fare amount charged"
      - name: tip_amount
        description: "Tip amount paid"
      - name: total_amount
        description: "Total fare including extras"
      - name: trip_distance
        description: "Distance of trip in miles"
      - name: run_date_bq
        description: "Pipeline run date for incremental load"

  - name: dim_payment_type
    description: "Dimension table for payment type codes and descriptions"
    columns:
      - name: payment_type
        description: "Payment type code"
        tests:
          - not_null
          - unique
      - name: payment_desc
        description: "Payment type description"

  - name: dim_location
    description: "Dimension table for taxi zones with borough and service zones"
    columns:
      - name: locationid
        description: "Unique location ID"
        tests:
          - not_null
          - unique
      - name: borough
        description: "Borough name"
      - name: zone
        description: "Taxi zone"
      - name: service_zone
        description: "Service zone (e.g. Boro, Yellow, Green)"

  - name: dim_holiday
    description: "Dimension table containing weekend dates (Friday-Sunday) expanded by hour for mobility analysis"
    columns:
      - name: date
        description: "The calendar date (only Friday, Saturday, Sunday)"
        tests:
          - not_null
      - name: holiday_type
        description: "The type of weekend day (Friday, Saturday, or Sunday)"
        tests:
          - not_null
      - name: hour
        description: "Hour of day (0â€“23)"
        tests:
          - not_null
      - name: holiday_hour
        description: "Timestamp representing the specific date + hour (granularity hour)"
        tests:
          - not_null
          - unique